(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[941],{1044:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>I});var t=a(5155),l=a(5655),r=a(2115),n=a(4913),i=a(157);let c=(0,i.A)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);var d=a(7554),o=a(3349),h=a(3920);let u=(0,i.A)("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),x=(0,i.A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var m=a(285),j=a(9323),p=a(5695),b=a(7481),f=a(6695),y=a(5127),g=a(2523),v=a(6424),N=a(8718),w=a(2333),k=a(5300),A=a(7990),C=a(4838),S=a(6095),_=a(9434);function M(e){let{data:s}=e,[a,l]=(0,r.useState)(""),n=(0,r.useMemo)(()=>a?s.filter(e=>{var s;return null==(s=e.EMAIL)?void 0:s.toLowerCase().includes(a.toLowerCase())}):s,[s,a]),i=(0,r.useMemo)(()=>n.map(e=>{var s;return{email:null!=(s=e.EMAIL)?s:"N/A",unsubscribe_date:(0,_.b)(e.date_added),status:e.status}}),[n]);return(0,t.jsxs)(f.Zp,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("div",{className:"w-full max-w-sm",children:(0,t.jsx)(g.p,{placeholder:"Filter by email...",value:a,onChange:e=>l(e.target.value),className:"w-full"})}),(0,t.jsxs)(C.rI,{children:[(0,t.jsx)(C.ty,{asChild:!0,children:(0,t.jsxs)(m.$,{variant:"outline",children:[(0,t.jsx)(N.A,{className:"mr-2 h-4 w-4"}),"Export Data"]})}),(0,t.jsxs)(C.SQ,{children:[(0,t.jsxs)(C._2,{onClick:()=>(0,S.FK)(i,"unsubscribes.json"),children:[(0,t.jsx)(w.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Export as JSON"})]}),(0,t.jsxs)(C._2,{onClick:()=>(0,S.VI)(i,"unsubscribes.csv"),children:[(0,t.jsx)(k.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Export as CSV"})]}),(0,t.jsxs)(C._2,{onClick:()=>(0,S.g9)(i,"unsubscribes.xml"),children:[(0,t.jsx)(A.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Export as XML"})]})]})]})]}),(0,t.jsx)(v.F,{className:"h-[600px]",children:(0,t.jsxs)(y.XI,{children:[(0,t.jsx)(y.A0,{className:"sticky top-0 bg-card",children:(0,t.jsxs)(y.Hj,{children:[(0,t.jsx)(y.nd,{children:"Email"}),(0,t.jsx)(y.nd,{children:"Status"}),(0,t.jsx)(y.nd,{children:"Date Unsubscribed"})]})}),(0,t.jsx)(y.BF,{children:n.map(e=>{var s;return(0,t.jsxs)(y.Hj,{children:[(0,t.jsx)(y.nA,{className:"font-medium",children:null!=(s=e.EMAIL)?s:"N/A"}),(0,t.jsx)(y.nA,{children:e.status}),(0,t.jsx)(y.nA,{children:(0,_.b)(e.date_added)})]},e.subscriber_uid)})})]})}),0===n.length&&(0,t.jsx)("div",{className:"text-center p-8 text-muted-foreground",children:"No unsubscribed users found."})]})}var E=a(2497),F=a(6104),L=a(5317),z=a(7328);let I=(0,l.A)(function(){let[e,s]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[i,y]=(0,r.useState)(!0),[g,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),k=(0,p.useRouter)(),{toast:A}=(0,b.dj)(),C=(0,r.useCallback)(async()=>{y(!0),w(null);try{let e=(0,L.rJ)(F.db,"rawLists"),a=(0,L.rJ)(F.db,"rawUnsubscribes"),t=await (0,L.GG)((0,L.P)(e)),r=await (0,L.GG)((0,L.P)(a)),n=t.docs.map(e=>e.data()),i=r.docs.map(e=>e.data());i.sort((e,s)=>{let a=e.date_added?new Date(e.date_added).getTime():0;return(s.date_added?new Date(s.date_added).getTime():0)-a}),l(n),s(i)}catch(s){console.error("Failed to fetch data from Firestore:",s);let e=s.message||"Could not fetch data from Firestore.";w(e),A({title:"Failed to Load Data",description:e,variant:"destructive"})}finally{y(!1)}},[A]);(0,r.useEffect)(()=>{C()},[C]);let S=(0,r.useCallback)(async()=>{v(!0),w(null);try{let e=await (0,z.X)();A({title:"Sync Successful",description:e.message})}catch(s){console.error("Sync failed:",s);let e=s.message||"Could not sync data from the API.";w(e),A({title:"Sync Failed",description:e,variant:"destructive"})}finally{v(!1),await C()}},[A,C]),_=async()=>{await (0,j.CI)(),k.push("/login")};return i&&0===e.length?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)(n.A,{className:"h-8 w-8 animate-spin"})}):(0,t.jsxs)("div",{className:"flex flex-col min-h-screen bg-background text-foreground",children:[(0,t.jsx)("header",{className:"sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,t.jsxs)("div",{className:"container flex h-16 items-center px-4 sm:px-6 lg:px-8",children:[(0,t.jsx)("div",{className:"mr-4 flex",children:(0,t.jsx)("h1",{className:"text-2xl font-bold text-primary",children:"Email Insights Pro"})}),(0,t.jsxs)("div",{className:"flex flex-1 items-center justify-end space-x-2",children:[(0,t.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>k.push("/"),children:[(0,t.jsx)(c,{className:"mr-2 h-4 w-4"}),"Dashboard"]}),(0,t.jsxs)(m.$,{variant:"default",size:"sm",onClick:S,disabled:g,children:[(0,t.jsx)(d.A,{className:"mr-2 h-4 w-4 ".concat(g?"animate-spin":"")}),g?"Syncing...":"Sync Unsubscribes"]}),(0,t.jsxs)(m.$,{variant:"outline",size:"sm",onClick:_,children:[(0,t.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]})}),(0,t.jsx)("main",{className:"flex-1",children:(0,t.jsxs)("div",{className:"container py-8 px-4 sm:px-6 lg:px-8 space-y-8",children:[(0,t.jsx)("section",{children:(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(E.h,{title:"Total Unsubscribes",value:i?"...":e.length.toLocaleString(),icon:(0,t.jsx)(h.A,{className:"h-4 w-4 text-muted-foreground"}),footer:"From last sync"}),(0,t.jsx)(E.h,{title:"Number of Lists",value:i?"...":(a||[]).length.toLocaleString(),icon:(0,t.jsx)(u,{className:"h-4 w-4 text-muted-foreground"}),footer:"From last sync"})]})}),(0,t.jsxs)(f.Zp,{children:[(0,t.jsxs)(f.aR,{children:[(0,t.jsx)(f.ZB,{children:"All Unsubscribed Users"}),(0,t.jsx)(f.BT,{children:"This table shows a consolidated list of all users who have unsubscribed from any of your email lists, based on the last successful data sync from Firestore."})]}),(0,t.jsx)(f.Wu,{children:i&&!g?(0,t.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,t.jsx)(n.A,{className:"h-8 w-8 animate-spin"}),(0,t.jsx)("p",{className:"ml-4 text-muted-foreground",children:"Fetching data from database..."})]}):N?(0,t.jsxs)("div",{className:"bg-destructive/10 text-destructive p-4 rounded-md space-y-2",children:[(0,t.jsxs)("h4",{className:"font-semibold text-lg flex items-center gap-2",children:[(0,t.jsx)(x,{}),"Could not load data"]}),(0,t.jsx)("pre",{className:"text-sm overflow-x-auto whitespace-pre-wrap",children:N})]}):(0,t.jsx)(M,{data:e})})]})]})})]})})},6642:(e,s,a)=>{Promise.resolve().then(a.bind(a,1044))}},e=>{var s=s=>e(e.s=s);e.O(0,[992,416,504,475,639,485,194,441,684,358],()=>s(6642)),_N_E=e.O()}]);