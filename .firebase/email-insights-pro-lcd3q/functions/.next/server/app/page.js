(()=>{var e={};e.id=974,e.ids=[974],e.modules={643:e=>{"use strict";e.exports=require("node:perf_hooks")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{"use strict";e.exports=require("node:buffer")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16141:e=>{"use strict";e.exports=require("node:zlib")},16698:e=>{"use strict";e.exports=require("node:async_hooks")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},21204:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var r=s(37413),a=s(48500);function i(){return(0,r.jsx)(a.DashboardClientWrapper,{})}},21820:e=>{"use strict";e.exports=require("os")},21921:(e,t,s)=>{Promise.resolve().then(s.bind(s,58922))},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32467:e=>{"use strict";e.exports=require("node:http2")},33873:e=>{"use strict";e.exports=require("path")},34589:e=>{"use strict";e.exports=require("node:assert")},34631:e=>{"use strict";e.exports=require("tls")},37067:e=>{"use strict";e.exports=require("node:http")},37366:e=>{"use strict";e.exports=require("dns")},37540:e=>{"use strict";e.exports=require("node:console")},41204:e=>{"use strict";e.exports=require("string_decoder")},41692:e=>{"use strict";e.exports=require("node:tls")},41792:e=>{"use strict";e.exports=require("node:querystring")},48500:(e,t,s)=>{"use strict";s.d(t,{DashboardClientWrapper:()=>r});let r=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call DashboardClientWrapper() from the server but DashboardClientWrapper is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/components/dashboard-client-wrapper.tsx","DashboardClientWrapper")},53053:e=>{"use strict";e.exports=require("node:diagnostics_channel")},55511:e=>{"use strict";e.exports=require("crypto")},57075:e=>{"use strict";e.exports=require("node:stream")},57975:e=>{"use strict";e.exports=require("node:util")},58922:(e,t,s)=>{"use strict";s.d(t,{DashboardClientWrapper:()=>M});var r=s(60687),a=s(78933),i=s(43210),n=s(52579),o=s(93090),l=s(77368),c=s(49497),d=s(82614);let u=(0,d.A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),x=(0,d.A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),p=(0,d.A)("MousePointerClick",[["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z",key:"s0h3yz"}]]);var m=s(36644),h=s(29523),g=s(63523),j=s(16189),f=s(29867);let b=e=>{if(!e||0===e.length)return{totalSends:0,totalOpens:0,totalClicks:0,totalUnsubscribes:0,avgOpenRate:0,avgClickThroughRate:0};let t=e.filter(e=>!e.campaignName.toLowerCase().includes("farm")),s=t.reduce((e,t)=>e+(t.totalSent||0),0),r=t.reduce((e,t)=>e+(t.opens||0),0),a=t.reduce((e,t)=>e+(t.clicks||0),0),i=t.reduce((e,t)=>e+(t.unsubscribes||0),0),n=t.reduce((e,t)=>e+(t.totalSent-t.bounces),0),o=n>0?parseFloat((r/n*100).toFixed(2)):0,l=n>0?parseFloat((a/n*100).toFixed(2)):0;return{totalSends:s,totalOpens:r,totalClicks:a,totalUnsubscribes:i,avgOpenRate:o,avgClickThroughRate:l}};var v=s(95775),N=s(6211),y=s(89667),w=s(20620),k=s(49589),S=s(54690),q=s(53691),_=s(21342),C=s(42692),A=s(44493);function F({data:e}){let[t,s]=(0,i.useState)(""),a=(0,i.useMemo)(()=>t?e.filter(e=>e.campaignName.toLowerCase().includes(t.toLowerCase())||e.subject.toLowerCase().includes(t.toLowerCase())):e,[e,t]);return(0,r.jsxs)(A.Zp,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,r.jsx)("div",{className:"w-full max-w-sm",children:(0,r.jsx)(y.p,{placeholder:"Filter by campaign name or subject...",value:t,onChange:e=>s(e.target.value),className:"w-full"})}),(0,r.jsxs)(_.rI,{children:[(0,r.jsx)(_.ty,{asChild:!0,children:(0,r.jsxs)(h.$,{variant:"outline",children:[(0,r.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Export Data"]})}),(0,r.jsxs)(_.SQ,{children:[(0,r.jsxs)(_._2,{onClick:()=>(0,q.FK)(a,"daily_report.json"),children:[(0,r.jsx)(k.A,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Export as JSON"})]}),(0,r.jsxs)(_._2,{onClick:()=>(0,q.VI)(a,"daily_report.csv"),children:[(0,r.jsx)(m.A,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Export as CSV"})]}),(0,r.jsxs)(_._2,{onClick:()=>(0,q.g9)(a,"daily_report.xml"),children:[(0,r.jsx)(S.A,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Export as XML"})]})]})]})]}),(0,r.jsx)(C.F,{className:"h-[400px]",children:(0,r.jsxs)(N.XI,{children:[(0,r.jsx)(N.A0,{className:"sticky top-0 bg-card",children:(0,r.jsxs)(N.Hj,{children:[(0,r.jsx)(N.nd,{children:"Date"}),(0,r.jsx)(N.nd,{children:"Campaign Name"}),(0,r.jsx)(N.nd,{children:"Subject"}),(0,r.jsx)(N.nd,{className:"text-right",children:"Sends"}),(0,r.jsx)(N.nd,{className:"text-right",children:"Opens"}),(0,r.jsx)(N.nd,{className:"text-right",children:"Open Rate"}),(0,r.jsx)(N.nd,{className:"text-right",children:"Clicks"}),(0,r.jsx)(N.nd,{className:"text-right",children:"Click Rate"}),(0,r.jsx)(N.nd,{className:"text-right",children:"Unsubscribes"}),(0,r.jsx)(N.nd,{className:"text-right",children:"Bounces"}),(0,r.jsx)(N.nd,{className:"text-right",children:"Delivery Rate"})]})}),(0,r.jsx)(N.BF,{children:a.map((e,t)=>(0,r.jsxs)(N.Hj,{children:[(0,r.jsx)(N.nA,{children:e.date}),(0,r.jsx)(N.nA,{className:"font-medium",children:e.campaignName}),(0,r.jsx)(N.nA,{children:e.subject}),(0,r.jsx)(N.nA,{className:"text-right",children:e.totalSent.toLocaleString()}),(0,r.jsx)(N.nA,{className:"text-right",children:e.opens.toLocaleString()}),(0,r.jsxs)(N.nA,{className:"text-right",children:[e.openRate.toFixed(2),"%"]}),(0,r.jsx)(N.nA,{className:"text-right",children:e.clicks.toLocaleString()}),(0,r.jsxs)(N.nA,{className:"text-right",children:[e.clickRate.toFixed(2),"%"]}),(0,r.jsx)(N.nA,{className:"text-right",children:e.unsubscribes.toLocaleString()}),(0,r.jsx)(N.nA,{className:"text-right",children:e.bounces.toLocaleString()}),(0,r.jsxs)(N.nA,{className:"text-right",children:[e.deliveryRate.toFixed(2),"%"]})]},t))})]})})]})}var P=s(33784),L=s(75535),R=s(4780),D=s(73421);function E(){let[e,t]=(0,i.useState)([]),[s,a]=(0,i.useState)(!0),[d,N]=(0,i.useState)(!1),y=(0,j.useRouter)(),{toast:w}=(0,f.dj)(),[k,S]=(0,i.useState)([]),[q,_]=(0,i.useState)([]),[C,E]=(0,i.useState)(null),[M,T]=(0,i.useState)(null),O=(0,i.useCallback)(async()=>{a(!0);try{let e=(0,L.rJ)(P.db,"rawCampaigns"),t=(0,L.rJ)(P.db,"rawStats"),s=(0,L.H9)(P.db,"jobStatus","dailyEmailReport"),r=(0,L.H9)(P.db,"jobStatus","hourlySync"),a=await (0,L.GG)((0,L.P)(e)),i=await (0,L.GG)((0,L.P)(t)),n=await (0,L.x7)(s),o=await (0,L.x7)(r),l=a.docs.map(e=>e.data()),c=i.docs.map(e=>e.data());S(l),_(c),n.exists()&&E(n.data()),o.exists()&&T(o.data())}catch(e){console.error("Failed to fetch reports from Firestore:",e),w({title:"Failed to load reports",description:e.message||"Could not fetch report data from Firestore.",variant:"destructive"})}finally{a(!1)}},[w]),z=(0,i.useMemo)(()=>b(e),[e]),G=(0,i.useMemo)(()=>{let e=function(e,t){let s=t.filter(e=>null!=e);if(!e||!s||0===e.length||0===s.length)return[];let r=new Map(e.map(e=>[e.campaign_uid,e])),a=[];for(let e of s){let t=r.get(e.campaign_uid);if(t&&"number"==typeof e.delivery_success_count&&e.delivery_success_count>0){let s=e.processed_count??0,r=e.delivery_success_count,i=e.unique_opens_count??0,n=e.unique_clicks_count??0,o=s>0?r/s*100:100,l=r>0?i/r*100:0,c=i>0?n/i*100:0,d=t.send_at||t.date_added;a.push({campaignUid:t.campaign_uid,date:(0,R.b)(d),campaignName:t.name,fromName:t.from_name,subject:t.subject,totalSent:s,opens:i,clicks:n,unsubscribes:e.unsubscribes_count??0,bounces:e.bounces_count??0,deliveryRate:parseFloat(o.toFixed(2)),openRate:parseFloat(l.toFixed(2)),clickRate:parseFloat(c.toFixed(2))})}}return a.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())}(k,q);return t(e),e},[k,q]),B=async()=>{N(!0);try{let e=await (0,D.X)();w({title:"Sync Successful",description:e.message}),await O()}catch(t){console.error("Client-side action error during sync:",t);let e=t instanceof Error?t.message:"An unknown error occurred";w({title:"Sync Failed",description:`Failed to complete data sync: ${e}`,variant:"destructive"})}finally{N(!1)}},I=async()=>{await (0,g.CI)(),y.push("/login")};return s&&0===e.length&&0===G.length?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(n.A,{className:"h-8 w-8 animate-spin"})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex flex-col min-h-screen bg-background text-foreground",children:[(0,r.jsx)("header",{className:"sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,r.jsxs)("div",{className:"container flex h-16 items-center px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)("div",{className:"mr-4 flex",children:(0,r.jsx)("h1",{className:"text-2xl font-bold text-primary",children:"Email Insights Pro"})}),(0,r.jsxs)("div",{className:"flex flex-1 items-center justify-end space-x-2",children:[(0,r.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>y.push("/unsubscribes"),children:[(0,r.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"View Unsubscribes"]}),(0,r.jsxs)(h.$,{variant:"default",size:"sm",onClick:B,disabled:d||s,children:[(0,r.jsx)(l.A,{className:`mr-2 h-4 w-4 ${d||s?"animate-spin":""}`}),d?"Syncing...":"Sync from API"]}),(0,r.jsxs)(h.$,{variant:"outline",size:"sm",onClick:I,children:[(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]})}),(0,r.jsx)("main",{className:"flex-1",children:(0,r.jsx)("div",{className:"container py-8 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,r.jsx)("section",{children:(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsx)(v.h,{title:"Total Sends",value:z.totalSends.toLocaleString(),icon:(0,r.jsx)(u,{className:"h-4 w-4 text-muted-foreground"}),footer:"Based on stored data"}),(0,r.jsx)(v.h,{title:"Total Opens",value:z.totalOpens.toLocaleString(),icon:(0,r.jsx)(u,{className:"h-4 w-4 text-muted-foreground"}),footer:"Based on stored data"}),(0,r.jsx)(v.h,{title:"Avg. Open Rate",value:`${z.avgOpenRate}%`,icon:(0,r.jsx)(x,{className:"h-4 w-4 text-muted-foreground"}),footer:"Based on stored data"}),(0,r.jsx)(v.h,{title:"Avg. Click Rate",value:`${z.avgClickThroughRate}%`,icon:(0,r.jsx)(p,{className:"h-4 w-4 text-muted-foreground"}),footer:"Based on stored data"})]})}),(0,r.jsx)("section",{children:(0,r.jsxs)(A.Zp,{children:[(0,r.jsxs)(A.aR,{children:[(0,r.jsx)(A.ZB,{children:"Automated Job Status"}),(0,r.jsx)(A.BT,{children:"This service automatically performs scheduled tasks like sending reports and syncing data."})]}),(0,r.jsxs)(A.Wu,{className:"grid gap-4 sm:grid-cols-2",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4 p-4 rounded-lg border bg-card",children:[(0,r.jsx)(l.A,{className:"h-6 w-6 text-primary mt-1"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Hourly Data Sync"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Syncs all data from the API every hour."}),s?(0,r.jsx)("p",{className:"text-muted-foreground mt-2",children:"Loading status..."}):M?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Last successful sync:"}),(0,r.jsx)("p",{className:"font-semibold text-sm text-foreground",children:M.lastSuccess?new Date(M.lastSuccess).toLocaleString():"Never"}),"failure"===M.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"text-destructive mt-1 text-xs",children:["Last attempt failed: ",new Date(M.lastFailure).toLocaleString()]}),(0,r.jsxs)("p",{className:"text-xs text-destructive",children:["Error: ",M.error]})]})]}):(0,r.jsx)("p",{className:"text-muted-foreground mt-2",children:"No hourly sync has run yet."})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-4 p-4 rounded-lg border bg-card",children:[(0,r.jsx)(m.A,{className:"h-6 w-6 text-primary mt-1"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Daily Email Report"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Sends a report daily at 7 PM EST (23:00 UTC)."}),s?(0,r.jsx)("p",{className:"text-muted-foreground mt-2",children:"Loading status..."}):C?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Last successful report:"}),(0,r.jsx)("p",{className:"font-semibold text-sm text-foreground",children:C.lastSuccess?new Date(C.lastSuccess).toLocaleString():"Never"}),"failure"===C.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"text-destructive mt-1 text-xs",children:["Last attempt failed: ",new Date(C.lastFailure).toLocaleString()]}),(0,r.jsxs)("p",{className:"text-xs text-destructive",children:["Error: ",C.error]})]})]}):(0,r.jsx)("p",{className:"text-muted-foreground mt-2",children:"No reports have been sent yet."})]})]})]})]})}),(0,r.jsxs)("section",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold tracking-tight mb-4",children:"Campaign Performance (from Firestore)"}),(0,r.jsx)(F,{data:e})]})]})})})]})})}let M=(0,a.A)(function(){return(0,r.jsx)(E,{})})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73136:e=>{"use strict";e.exports=require("node:url")},73429:e=>{"use strict";e.exports=require("node:util/types")},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},75919:e=>{"use strict";e.exports=require("node:worker_threads")},77030:e=>{"use strict";e.exports=require("node:net")},77598:e=>{"use strict";e.exports=require("node:crypto")},78474:e=>{"use strict";e.exports=require("node:events")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},85473:(e,t,s)=>{Promise.resolve().then(s.bind(s,48500))},90462:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c});var r=s(65239),a=s(48088),i=s(88170),n=s.n(i),o=s(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c={children:["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,21204)),"/home/user/studio/src/app/page.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,94431)),"/home/user/studio/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/home/user/studio/src/app/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[447,724,611,30,246,215,361,184,67],()=>s(90462));module.exports=r})();