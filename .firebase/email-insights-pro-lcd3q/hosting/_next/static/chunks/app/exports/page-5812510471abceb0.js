(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[958],{225:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>C});var t=a(5155),c=a(6365),r=a(6695),n=a(285),l=a(9409),i=a(2346),d=a(6126),o=a(2115),x=a(5317),m=a(6104);function h(e,s){let a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download=s,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)}var p=a(157);let u=(0,p.A)("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),j=(0,p.A)("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),f=(0,p.A)("FileCode",[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]]);var g=a(8718),N=a(4913),y=a(7554),v=a(5299),b=a(9637),w=a(5727),k=a(3920),S=a(7481);function C(){return(0,t.jsx)(c.C,{children:(0,t.jsx)(E,{})})}function E(){let[e,s]=(0,o.useState)([]),[a,c]=(0,o.useState)([]),[p,C]=(0,o.useState)([]),[E,_]=(0,o.useState)([]),[A,R]=(0,o.useState)(!0),[Z,U]=(0,o.useState)(!1),[B,F]=(0,o.useState)("json"),{toast:M}=(0,S.dj)(),O=async()=>{try{let[e,a,t]=await Promise.all([(0,x.GG)((0,x.rJ)(m.db,"rawCampaigns")),(0,x.GG)((0,x.rJ)(m.db,"rawStats")),(0,x.GG)((0,x.rJ)(m.db,"rawUnsubscribers"))]),r=e.docs.map(e=>e.data()),n=a.docs.map(e=>e.data()),l=t.docs.map(e=>e.data()).filter(e=>"unsubscribed"===e.status),i=new Map;r.forEach(e=>{i.set(e.campaign_uid,e)});let d=[];for(let e of n){let s=i.get(e.campaign_uid);if(s&&"number"==typeof e.delivery_success_count&&e.delivery_success_count>0){let a=e.processed_count||0,t=e.delivery_success_count,c=e.unique_opens_count||0,r=e.unique_clicks_count||0,n=e.unsubscribes_count||0,l=e.bounces_count||0,i=a>0?t/a*100:100,o=t>0?c/t*100:0,x=c>0?r/c*100:0,m=s.send_at||s.date_added;d.push({campaignUid:s.campaign_uid,date:D(m),campaignName:s.name,fromName:s.from_name,subject:s.subject,totalSent:a,opens:c,clicks:r,unsubscribes:n,bounces:l,deliveryRate:parseFloat(i.toFixed(2)),openRate:parseFloat(o.toFixed(2)),clickRate:parseFloat(x.toFixed(2))})}}d.sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime()),s(r),c(n),C(l),_(d)}catch(e){console.error("Failed to fetch export data:",e),M({title:"Failed to load data",description:"Could not fetch data for export.",variant:"destructive"})}finally{R(!1)}};(0,o.useEffect)(()=>{O()},[]);let T=async()=>{U(!0);try{let e=await fetch("/api/manual-sync",{method:"GET"}),s=await e.json();if(!e.ok)throw Error(s.error||"Sync failed due to server error.");M({title:"Sync Successful",description:s.message}),await O()}catch(s){console.error("Sync error:",s);let e=s instanceof Error?s.message:"An unknown error occurred";M({title:"Sync Failed",description:"Failed to complete data sync: ".concat(e),variant:"destructive"})}finally{U(!1)}},D=e=>{try{return new Date(e).toISOString().split("T")[0]}catch(e){return new Date().toISOString().split("T")[0]}},P=e=>{switch(e){case"json":return(0,t.jsx)(u,{className:"h-4 w-4"});case"csv":return(0,t.jsx)(j,{className:"h-4 w-4"});case"xml":return(0,t.jsx)(f,{className:"h-4 w-4"});default:return(0,t.jsx)(g.A,{className:"h-4 w-4"})}},q=(e,s)=>{if(0===s.length)return void M({title:"No data to export",description:"No ".concat(e," data available for export."),variant:"destructive"});let a=new Date().toISOString().split("T")[0],t="email-insights-".concat(e,"-").concat(a);try{switch(B){case"json":!function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data.json";h(new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s)}(s,"".concat(t,".json"));break;case"csv":!function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data.csv";if(0===e.length)return;let a=Object.keys(e[0]);h(new Blob([[a.join(","),...e.map(e=>a.map(s=>JSON.stringify(e[s],(e,s)=>null===s?"":s)).join(","))].join("\r\n")],{type:"text/csv;charset=utf-8;"}),s)}(s,"".concat(t,".csv"));break;case"xml":!function(e){let s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data.xml";h(new Blob([(s='<?xml version="1.0" encoding="UTF-8"?>\n<reports>\n',e.forEach(e=>{for(let a in s+="  <report>\n",e)Object.prototype.hasOwnProperty.call(e,a)&&(s+="    <".concat(a,">").concat(e[a],"</").concat(a,">\n"));s+="  </report>\n"}),s+="</reports>")],{type:"application/xml"}),a)}(s,"".concat(t,".xml"))}M({title:"Export successful",description:"".concat(e," data exported as ").concat(B.toUpperCase(),".")})}catch(e){console.error("Export error:",e),M({title:"Export failed",description:"Failed to export data. Please try again.",variant:"destructive"})}};return A?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)(N.A,{className:"h-8 w-8 animate-spin"})}):(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Data Exports"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Export email campaign data in multiple formats"})]}),(0,t.jsxs)(n.$,{onClick:T,disabled:Z,variant:"outline",children:[(0,t.jsx)(y.A,{className:"h-4 w-4 mr-2 ".concat(Z?"animate-spin":"")}),Z?"Syncing...":"Sync Data"]})]}),(0,t.jsxs)(r.Zp,{className:"mb-6",children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"h-5 w-5"}),"Export Settings"]}),(0,t.jsx)(r.BT,{children:"Choose your preferred export format"})]}),(0,t.jsx)(r.Wu,{children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Export Format:"}),(0,t.jsxs)(l.l6,{value:B,onValueChange:e=>F(e),children:[(0,t.jsx)(l.bq,{className:"w-40",children:(0,t.jsx)(l.yv,{})}),(0,t.jsxs)(l.gC,{children:[(0,t.jsx)(l.eb,{value:"json",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u,{className:"h-4 w-4"}),"JSON"]})}),(0,t.jsx)(l.eb,{value:"csv",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j,{className:"h-4 w-4"}),"CSV"]})}),(0,t.jsx)(l.eb,{value:"xml",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f,{className:"h-4 w-4"}),"XML"]})})]})]})]})})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(r.ZB,{className:"text-sm font-medium",children:"Campaign Reports"}),(0,t.jsx)(v.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(r.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:E.length.toLocaleString()}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Performance reports"})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(r.ZB,{className:"text-sm font-medium",children:"Campaigns"}),(0,t.jsx)(b.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(r.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:e.length.toLocaleString()}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total campaigns"})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(r.ZB,{className:"text-sm font-medium",children:"Statistics"}),(0,t.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(r.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:a.length.toLocaleString()}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Campaign stats"})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(r.ZB,{className:"text-sm font-medium",children:"Unsubscribes"}),(0,t.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(r.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:p.length.toLocaleString()}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Unsubscribed users"})]})]})]}),(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"h-5 w-5"}),"Campaign Performance Reports"]}),(0,t.jsx)(r.BT,{children:"Comprehensive performance data with metrics and rates"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Daily Reports"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[E.length," reports with delivery, open, and click rates"]})]}),(0,t.jsxs)(d.E,{variant:"secondary",children:[E.length," records"]})]}),(0,t.jsx)(i.w,{}),(0,t.jsxs)(n.$,{onClick:()=>q("reports",E),className:"w-full",disabled:0===E.length,children:[P(B),(0,t.jsxs)("span",{className:"ml-2",children:["Export Reports as ",B.toUpperCase()]})]})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(b.A,{className:"h-5 w-5"}),"Campaign Data"]}),(0,t.jsx)(r.BT,{children:"Raw campaign information and metadata"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Campaign Details"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.length," campaigns with names, subjects, and status"]})]}),(0,t.jsxs)(d.E,{variant:"secondary",children:[e.length," records"]})]}),(0,t.jsx)(i.w,{}),(0,t.jsxs)(n.$,{onClick:()=>q("campaigns",e),className:"w-full",disabled:0===e.length,children:[P(B),(0,t.jsxs)("span",{className:"ml-2",children:["Export Campaigns as ",B.toUpperCase()]})]})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(w.A,{className:"h-5 w-5"}),"Statistics Data"]}),(0,t.jsx)(r.BT,{children:"Raw statistical data from EP MailPro"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Campaign Statistics"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.length," statistical records with counts and metrics"]})]}),(0,t.jsxs)(d.E,{variant:"secondary",children:[a.length," records"]})]}),(0,t.jsx)(i.w,{}),(0,t.jsxs)(n.$,{onClick:()=>q("stats",a),className:"w-full",disabled:0===a.length,children:[P(B),(0,t.jsxs)("span",{className:"ml-2",children:["Export Statistics as ",B.toUpperCase()]})]})]})]}),(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(k.A,{className:"h-5 w-5"}),"Unsubscribes Data"]}),(0,t.jsx)(r.BT,{children:"Users who have unsubscribed from campaigns"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Unsubscribed Users"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[p.length," unsubscribed users with email and dates"]})]}),(0,t.jsxs)(d.E,{variant:"secondary",children:[p.length," records"]})]}),(0,t.jsx)(i.w,{}),(0,t.jsxs)(n.$,{onClick:()=>q("unsubscribers",p),className:"w-full",disabled:0===p.length,children:[P(B),(0,t.jsxs)("span",{className:"ml-2",children:["Export Unsubscribes as ",B.toUpperCase()]})]})]})]})]}),(0,t.jsxs)(r.Zp,{className:"mt-6",children:[(0,t.jsxs)(r.aR,{children:[(0,t.jsx)(r.ZB,{children:"Export Information"}),(0,t.jsx)(r.BT,{children:"Important details about data exports"})]}),(0,t.jsxs)(r.Wu,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u,{className:"h-4 w-4 text-blue-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"JSON Format"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Structured data for APIs"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j,{className:"h-4 w-4 text-green-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"CSV Format"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Excel-compatible tables"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f,{className:"h-4 w-4 text-orange-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"XML Format"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Structured markup data"})]})]})]}),(0,t.jsx)(i.w,{}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"All exports include timestamp in filename. Data is current as of the last sync from EP MailPro."})]})]})]})}},749:(e,s,a)=>{Promise.resolve().then(a.bind(a,225))},3920:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(157).A)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]])},5299:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(157).A)("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[135,210,553,169,889,925,441,684,358],()=>s(749)),_N_E=e.O()}]);