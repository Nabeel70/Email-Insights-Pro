(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6351:(e,s,t)=>{Promise.resolve().then(t.bind(t,8664))},8664:(e,s,t)=>{"use strict";t.d(s,{DashboardClientWrapper:()=>T});var a=t(5155),r=t(5655),l=t(2115),n=t(4913),c=t(3920),i=t(7554),d=t(3349),o=t(157);let x=(0,o.A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),m=(0,o.A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),u=(0,o.A)("MousePointerClick",[["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z",key:"s0h3yz"}]]);var h=t(5300),p=t(285),j=t(9323),g=t(5695),f=t(7481);let N=e=>{if(!e||0===e.length)return{totalSends:0,totalOpens:0,totalClicks:0,totalUnsubscribes:0,avgOpenRate:0,avgClickThroughRate:0};let s=e.filter(e=>!e.campaignName.toLowerCase().includes("farm")),t=s.reduce((e,s)=>e+(s.totalSent||0),0),a=s.reduce((e,s)=>e+(s.opens||0),0),r=s.reduce((e,s)=>e+(s.clicks||0),0),l=s.reduce((e,s)=>e+(s.unsubscribes||0),0),n=s.reduce((e,s)=>e+(s.totalSent-s.bounces),0),c=n>0?parseFloat((a/n*100).toFixed(2)):0,i=n>0?parseFloat((r/n*100).toFixed(2)):0;return{totalSends:t,totalOpens:a,totalClicks:r,totalUnsubscribes:l,avgOpenRate:c,avgClickThroughRate:i}};var b=t(2497),y=t(5127),v=t(2523),S=t(8718),k=t(2333),w=t(7990),A=t(6095),C=t(4838),F=t(6424),_=t(6695);function L(e){let{data:s}=e,[t,r]=(0,l.useState)(""),n=(0,l.useMemo)(()=>t?s.filter(e=>e.campaignName.toLowerCase().includes(t.toLowerCase())||e.subject.toLowerCase().includes(t.toLowerCase())):s,[s,t]);return(0,a.jsxs)(_.Zp,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsx)("div",{className:"w-full max-w-sm",children:(0,a.jsx)(v.p,{placeholder:"Filter by campaign name or subject...",value:t,onChange:e=>r(e.target.value),className:"w-full"})}),(0,a.jsxs)(C.rI,{children:[(0,a.jsx)(C.ty,{asChild:!0,children:(0,a.jsxs)(p.$,{variant:"outline",children:[(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"}),"Export Data"]})}),(0,a.jsxs)(C.SQ,{children:[(0,a.jsxs)(C._2,{onClick:()=>(0,A.FK)(n,"daily_report.json"),children:[(0,a.jsx)(k.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Export as JSON"})]}),(0,a.jsxs)(C._2,{onClick:()=>(0,A.VI)(n,"daily_report.csv"),children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Export as CSV"})]}),(0,a.jsxs)(C._2,{onClick:()=>(0,A.g9)(n,"daily_report.xml"),children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Export as XML"})]})]})]})]}),(0,a.jsx)(F.F,{className:"h-[400px]",children:(0,a.jsxs)(y.XI,{children:[(0,a.jsx)(y.A0,{className:"sticky top-0 bg-card",children:(0,a.jsxs)(y.Hj,{children:[(0,a.jsx)(y.nd,{children:"Date"}),(0,a.jsx)(y.nd,{children:"Campaign Name"}),(0,a.jsx)(y.nd,{children:"Subject"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Sends"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Opens"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Open Rate"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Clicks"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Click Rate"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Unsubscribes"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Bounces"}),(0,a.jsx)(y.nd,{className:"text-right",children:"Delivery Rate"})]})}),(0,a.jsx)(y.BF,{children:n.map((e,s)=>(0,a.jsxs)(y.Hj,{children:[(0,a.jsx)(y.nA,{children:e.date}),(0,a.jsx)(y.nA,{className:"font-medium",children:e.campaignName}),(0,a.jsx)(y.nA,{children:e.subject}),(0,a.jsx)(y.nA,{className:"text-right",children:e.totalSent.toLocaleString()}),(0,a.jsx)(y.nA,{className:"text-right",children:e.opens.toLocaleString()}),(0,a.jsxs)(y.nA,{className:"text-right",children:[e.openRate.toFixed(2),"%"]}),(0,a.jsx)(y.nA,{className:"text-right",children:e.clicks.toLocaleString()}),(0,a.jsxs)(y.nA,{className:"text-right",children:[e.clickRate.toFixed(2),"%"]}),(0,a.jsx)(y.nA,{className:"text-right",children:e.unsubscribes.toLocaleString()}),(0,a.jsx)(y.nA,{className:"text-right",children:e.bounces.toLocaleString()}),(0,a.jsxs)(y.nA,{className:"text-right",children:[e.deliveryRate.toFixed(2),"%"]})]},s))})]})})]})}var R=t(6104),E=t(5317),D=t(9434),O=t(7328);function M(){let[e,s]=(0,l.useState)([]),[t,r]=(0,l.useState)(!0),[o,y]=(0,l.useState)(!1),v=(0,g.useRouter)(),{toast:S}=(0,f.dj)(),[k,w]=(0,l.useState)([]),[A,C]=(0,l.useState)([]),[F,M]=(0,l.useState)(null),[T,P]=(0,l.useState)(null),B=(0,l.useCallback)(async()=>{r(!0);try{let e=(0,E.rJ)(R.db,"rawCampaigns"),s=(0,E.rJ)(R.db,"rawStats"),t=(0,E.H9)(R.db,"jobStatus","dailyEmailReport"),a=(0,E.H9)(R.db,"jobStatus","hourlySync"),r=await (0,E.GG)((0,E.P)(e)),l=await (0,E.GG)((0,E.P)(s)),n=await (0,E.x7)(t),c=await (0,E.x7)(a),i=r.docs.map(e=>e.data()),d=l.docs.map(e=>e.data());w(i),C(d),n.exists()&&M(n.data()),c.exists()&&P(c.data())}catch(e){console.error("Failed to fetch reports from Firestore:",e),S({title:"Failed to load reports",description:e.message||"Could not fetch report data from Firestore.",variant:"destructive"})}finally{r(!1)}},[S]);(0,l.useEffect)(()=>{B()},[B]);let I=(0,l.useMemo)(()=>N(e),[e]),z=(0,l.useMemo)(()=>{let e=function(e,s){let t=s.filter(e=>null!=e);if(!e||!t||0===e.length||0===t.length)return[];let a=new Map(e.map(e=>[e.campaign_uid,e])),r=[];for(let e of t){let s=a.get(e.campaign_uid);if(s&&"number"==typeof e.delivery_success_count&&e.delivery_success_count>0){var l,n,c,i,d;let t=null!=(l=e.processed_count)?l:0,a=e.delivery_success_count,o=null!=(n=e.unique_opens_count)?n:0,x=null!=(c=e.unique_clicks_count)?c:0,m=t>0?a/t*100:100,u=a>0?o/a*100:0,h=o>0?x/o*100:0,p=s.send_at||s.date_added;r.push({campaignUid:s.campaign_uid,date:(0,D.b)(p),campaignName:s.name,fromName:s.from_name,subject:s.subject,totalSent:t,opens:o,clicks:x,unsubscribes:null!=(i=e.unsubscribes_count)?i:0,bounces:null!=(d=e.bounces_count)?d:0,deliveryRate:parseFloat(m.toFixed(2)),openRate:parseFloat(u.toFixed(2)),clickRate:parseFloat(h.toFixed(2))})}}return r.sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime())}(k,A);return s(e),e},[k,A]),U=async()=>{y(!0);try{let e=await (0,O.X)();S({title:"Sync Successful",description:e.message}),await B()}catch(s){console.error("Client-side action error during sync:",s);let e=s instanceof Error?s.message:"An unknown error occurred";S({title:"Sync Failed",description:"Failed to complete data sync: ".concat(e),variant:"destructive"})}finally{y(!1)}},H=async()=>{await (0,j.CI)(),v.push("/login")};return t&&0===e.length&&0===z.length?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)(n.A,{className:"h-8 w-8 animate-spin"})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-background text-foreground",children:[(0,a.jsx)("header",{className:"sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,a.jsxs)("div",{className:"container flex h-16 items-center px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"mr-4 flex",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-primary",children:"Email Insights Pro"})}),(0,a.jsxs)("div",{className:"flex flex-1 items-center justify-end space-x-2",children:[(0,a.jsxs)(p.$,{variant:"outline",size:"sm",onClick:()=>v.push("/unsubscribes"),children:[(0,a.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"View Unsubscribes"]}),(0,a.jsxs)(p.$,{variant:"default",size:"sm",onClick:U,disabled:o||t,children:[(0,a.jsx)(i.A,{className:"mr-2 h-4 w-4 ".concat(o||t?"animate-spin":"")}),o?"Syncing...":"Sync from API"]}),(0,a.jsxs)(p.$,{variant:"outline",size:"sm",onClick:H,children:[(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]})}),(0,a.jsx)("main",{className:"flex-1",children:(0,a.jsx)("div",{className:"container py-8 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,a.jsx)("section",{children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsx)(b.h,{title:"Total Sends",value:I.totalSends.toLocaleString(),icon:(0,a.jsx)(x,{className:"h-4 w-4 text-muted-foreground"}),footer:"Based on stored data"}),(0,a.jsx)(b.h,{title:"Total Opens",value:I.totalOpens.toLocaleString(),icon:(0,a.jsx)(x,{className:"h-4 w-4 text-muted-foreground"}),footer:"Based on stored data"}),(0,a.jsx)(b.h,{title:"Avg. Open Rate",value:"".concat(I.avgOpenRate,"%"),icon:(0,a.jsx)(m,{className:"h-4 w-4 text-muted-foreground"}),footer:"Based on stored data"}),(0,a.jsx)(b.h,{title:"Avg. Click Rate",value:"".concat(I.avgClickThroughRate,"%"),icon:(0,a.jsx)(u,{className:"h-4 w-4 text-muted-foreground"}),footer:"Based on stored data"})]})}),(0,a.jsx)("section",{children:(0,a.jsxs)(_.Zp,{children:[(0,a.jsxs)(_.aR,{children:[(0,a.jsx)(_.ZB,{children:"Automated Job Status"}),(0,a.jsx)(_.BT,{children:"This service automatically performs scheduled tasks like sending reports and syncing data."})]}),(0,a.jsxs)(_.Wu,{className:"grid gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"flex items-start gap-4 p-4 rounded-lg border bg-card",children:[(0,a.jsx)(i.A,{className:"h-6 w-6 text-primary mt-1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Hourly Data Sync"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Syncs all data from the API every hour."}),t?(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Loading status..."}):T?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Last successful sync:"}),(0,a.jsx)("p",{className:"font-semibold text-sm text-foreground",children:T.lastSuccess?new Date(T.lastSuccess).toLocaleString():"Never"}),"failure"===T.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-destructive mt-1 text-xs",children:["Last attempt failed: ",new Date(T.lastFailure).toLocaleString()]}),(0,a.jsxs)("p",{className:"text-xs text-destructive",children:["Error: ",T.error]})]})]}):(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"No hourly sync has run yet."})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-4 p-4 rounded-lg border bg-card",children:[(0,a.jsx)(h.A,{className:"h-6 w-6 text-primary mt-1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Daily Email Report"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Sends a report daily at 7 PM EST (23:00 UTC)."}),t?(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Loading status..."}):F?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Last successful report:"}),(0,a.jsx)("p",{className:"font-semibold text-sm text-foreground",children:F.lastSuccess?new Date(F.lastSuccess).toLocaleString():"Never"}),"failure"===F.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-destructive mt-1 text-xs",children:["Last attempt failed: ",new Date(F.lastFailure).toLocaleString()]}),(0,a.jsxs)("p",{className:"text-xs text-destructive",children:["Error: ",F.error]})]})]}):(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"No reports have been sent yet."})]})]})]})]})}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold tracking-tight mb-4",children:"Campaign Performance (from Firestore)"}),(0,a.jsx)(L,{data:e})]})]})})})]})})}let T=(0,r.A)(function(){return(0,a.jsx)(M,{})})}},e=>{var s=s=>e(e.s=s);e.O(0,[992,416,504,475,639,485,194,441,684,358],()=>s(6351)),_N_E=e.O()}]);